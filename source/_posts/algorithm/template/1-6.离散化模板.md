---
title: 算法模板1-6.离散化模板
categories:
  - [Algorithm, Template]
---

# 整数保序离散化

## 适用情景

值域跨度大，但数非常稀疏。即数的范围比较大，但个数比较少。

> 如：值域0~10^9^，个数10^5^。

需要以数的值作为数组下标。这时需要用一个数组a[]对它们做映射。

## 问题

1. 数组a[]中可能有重复元素 -> **需要去重**，用cpp库函数erase()
2. 如何算出某个数x离散化后的值（在a[]中的下标）是多少？ -> **二分**

## 代码模板

```cpp
vector<int> alls; // 存储所有待离散化的值

// 两行代码实现排序+去重
sort(alls.begin(), alls.end()); // 将所有值排序
alls.erase(unique(alls.begin(), alls.end()), alls.end()); //去掉重复元素（unique把所有不重复元素放到数组最前面，并返回这一段元素的尾端点的后一个端点，然后就可以用erase把这个端点到整个数组的尾端点这一段，即多余的重复元素删掉）

// 二分求出x对应的离散化的值
int find(int x)  { // 找到第一个大于等于x的值对应的下标
    int l = 0, r = alls.size() - 1;
    while (l < r) {
        int mid = l + r >> 1;
        if (alls[mid] >= x) r = mid;
        else l = mid + 1;
    }
    return r + 1; // 为了方便建立前缀和数组，映射到1, 2, ..., n （如果需要映射到0, 1, ..., n - 1，return r即可）
}
```

## 例子：区间和

假定有一个无限长的数轴，数轴上每个坐标上的数都是 0。

现在，我们首先进行 n 次操作，每次操作将某一位置 x 上的数加 c。

接下来，进行 m 次询问，每个询问包含两个整数 l 和 r，你需要求出在区间 [l,r] 之间的所有数的和。

#### 输入格式

第一行包含两个整数 n 和 m。

接下来 n 行，每行包含两个整数 x 和 c。

再接下来 m 行，每行包含两个整数 l 和 r。

#### 输出格式

共 m 行，每行输出一个询问中所求的区间内数字和。

#### 数据范围

−10^9^≤ x ≤10^9^
1≤ n,m ≤10^5^
−10^9^≤ l ≤ r ≤10^9^
−10000≤ c ≤10000

#### 输入样例：

```
3 3
1 2
3 6
7 5
1 3
4 6
7 8
```

#### 输出样例：

```
8
0
5
```

x, l和r都需要离散化存到a[]中，共3×10^5^的空间复杂度

最后query的区间和用离散化之后的数组求前缀和得出。

> 注：如果值域跨度小，也可以直接用前缀和来做。