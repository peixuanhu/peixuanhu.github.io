---
title: 设计模式16-状态模式
categories:
	- Design Pattern
---

# 状态模式

## 定义

状态模式（State），当一个对象的内在状态改变时允许改变其行为，这个对象看起来像是改变了其类。

> 状态模式主要解决的是当控制一个对象**状态转换的条件表达式过于复杂**时的情况。把状态的判断逻辑转移到表示不同状态的一系列类当中，可以把复杂的判断逻辑简化。

## 结构图

![状态模式结构图.png](https://s2.loli.net/2023/10/12/MP5HFstNdQUkrT1.png)

`State` 类：抽象状态类，定义一个接口以封装与 `Context` 的一个特定状态相关的行为。

`ConcreteState` 类：具体状态，每一个子类实现一个与 `Context` 的一个状态相关的行为。

`Context` 类：维护一个 `ConcreteState` 类的实例，这个实例定义当前的状态（可以修改 `State` 的类型）。



## 基本代码

`State` 类：

```java
abstract class State {
  
  public abstract void handle(Context context);
}
```

`ConcreteState` 类：

```java
// 具体状态类A
class ConcreteStateA extends State {
  
  public void handle(Context context) {
    //可以在方法里做一些事情
    
    context.setState(new ConcreteStateB()); // 设置 ConcreteStateA 的下一状态是 ConcreteStateB
  }
}

// 具体状态类B
class ConcreteStateB extends State {
  
  public void handle(Context context) {
    //可以在方法里做一些事情
    
    context.setState(new ConcreteStateA()); // 设置 ConcreteStateB 的下一状态是 ConcreteStateA
  }
}
```

`Context` 类：

```java
class Context {
  
  private State state;
  
  public Context(State state) {
    this.state = state; // 设置 Context 的初始状态
  }
  
  // 可读写的状态属性，用于读取当前状态和设置新状态
  public State getState() {
    return this.state;
  }
  
  public void setState(State value) {
    this.state = value;
    System.out.println("当前状态：" + this.state.getClass().getName());
  }
  
  public void request() {
    this.state.handle(this);
  }
}
```

客户端代码：

```java
Context c = new Context(new ConcreteStateA()); // 设置c的初始状态为 ConcreteStateA

// 不断请求，不断更改状态
c.request();
c.request();
c.request();
c.request();
```

## 好处与使用场景

### 好处

将与特定状态相关的行为局部化，并且将不同状态的行为分割开来。

> 将特定的状态相关的行为都放入一个对象中，由于所有与状态相关的代码都存在于某个ConcreteState中，所以通过定义新的子类可以很容易地增加新的状态和转换。

这样做可以消除 `Long Method` 中庞大的条件分支语句。大的分支判断会使得它们难以修改和扩展。

状态模式通过把各种状态转移逻辑分布到 `State` 的子类之间，来减少相互间的依赖，这样就容易维护和扩展了。

### 使用场景

当一个对象的行为取决于它的状态，并且它必须在运行时刻根据状态改变它的行为时，就可以考虑使用状态模式。

> 如果业务需求某项业务有多个状态，通常都是一些枚举常量。
>
> 状态的变化都是依靠大量的多分支判断语句来实现，此时应该考虑**将每一种业务状态定义为一个State的子类**，于是这些对象就可以不依赖于其他对象而独立变化了。
>
> 某一天客户需要更改需求，增加或减少业务状态或改变状态流程，就变得不困难了。