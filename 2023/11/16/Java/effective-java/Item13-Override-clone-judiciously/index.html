

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.png">
  <link rel="icon" href="/img/avatar.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Peixuan Hu">
  <meta name="keywords" content="">
  
    <meta name="description" content="Item 13: Override clone judiciouslyThe Cloneable interface was intended as a mixin interface (Item 20) for classes to advertise that they permit cloning. Unfortunately, it fails to serve this purpose.">
<meta property="og:type" content="article">
<meta property="og:title" content="Effective Java-13. Override clone judiciously">
<meta property="og:url" content="https://peixuanhu.github.io/2023/11/16/Java/effective-java/Item13-Override-clone-judiciously/index.html">
<meta property="og:site_name" content="Peixuan&#39;s Page">
<meta property="og:description" content="Item 13: Override clone judiciouslyThe Cloneable interface was intended as a mixin interface (Item 20) for classes to advertise that they permit cloning. Unfortunately, it fails to serve this purpose.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-11-16T03:53:22.574Z">
<meta property="article:modified_time" content="2023-11-22T06:16:33.337Z">
<meta property="article:author" content="Peixuan Hu">
<meta name="twitter:card" content="summary_large_image">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Effective Java-13. Override clone judiciously - Peixuan&#39;s Page</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"peixuanhu.github.io","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":6},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Peixuan&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Effective Java-13. Override clone judiciously"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-11-16 11:53" pubdate>
          November 16, 2023 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          7.8k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          65 mins
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> views
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Effective Java-13. Override clone judiciously</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Item-13-Override-clone-judiciously"><a href="#Item-13-Override-clone-judiciously" class="headerlink" title="Item 13: Override clone judiciously"></a>Item 13: Override <em>clone</em> judiciously</h1><p>The <code>Cloneable</code> interface was intended as a <em>mixin interface</em> (Item 20) for classes to advertise that they permit cloning. Unfortunately, it fails to serve this purpose. Its primary flaw is that it lacks a <code>clone</code> method, and <em>Object</em>’s <code>clone</code> method is protected.</p>
<blockquote>
<p>You cannot, without resorting to <em>reflection</em> (Item 65), invoke clone on an object merely  because it implements <code>Cloneable</code>. Even a reflective invocation may fail, because there is no guarantee that the object has an accessible <code>clone</code> method.</p>
</blockquote>
<h2 id="Effect-of-Cloneable"><a href="#Effect-of-Cloneable" class="headerlink" title="Effect of Cloneable"></a>Effect of <em>Cloneable</em></h2><p>It determines the behavior of <em>Object</em>’s protected <code>clone</code> implementation: if a class implements <code>Cloneable</code>, <em>Object</em>’s <code>clone</code> method returns a <strong>field-by-field copy of the object</strong>; otherwise it throws <code>CloneNotSupportedException</code>.</p>
<blockquote>
<p>This is a highly atypical use of interfaces and not one to be emulated. Normally, implementing an interface says something about what a class can do for its clients. In this case, it modifies the behavior of a protected method on a superclass.</p>
</blockquote>
<p><strong>In practice, a class implementing</strong> <strong><code>Cloneable</code></strong> <strong>is expected to provide a properly functioning public</strong> <strong><code>clone</code></strong> <strong>method.</strong></p>
<h2 id="General-contract-of-clone"><a href="#General-contract-of-clone" class="headerlink" title="General contract of clone"></a>General contract of <em>clone</em></h2><p>Creates and returns a copy of this object. The precise meaning of “copy” may depend on the class of the object.</p>
<ul>
<li><code>x.clone() != x</code> will be true</li>
<li><code>x.clone().getclass() == x.getclass()</code> will be true</li>
<li><code>x.clone().equals(x)</code> will be true</li>
<li>By convention, the object returned by this method should be obtained by calling <code>super.clone()</code>.</li>
<li>By convention, <strong>the returned object should be independent of the object being cloned</strong>. To achieve this independence, it may be necessary to modify one or more fields of the object returned by super.clone before returning it.</li>
</ul>
<blockquote>
<p>If a class’s clone method returns an instance that is <em>not</em> obtained by calling <code>super.clone</code> but by calling a constructor, the compiler won’t complain, but if a subclass of that class calls <code>super.clone</code>, the resulting object will have the wrong class.</p>
</blockquote>
<h2 id="How-to-implment-clone-method"><a href="#How-to-implment-clone-method" class="headerlink" title="How to implment clone method"></a>How to implment <em>clone</em> method</h2><h3 id="1-Immutable-class"><a href="#1-Immutable-class" class="headerlink" title="1. Immutable class"></a>1. Immutable class</h3><p><strong>Immutable classes should never provide a</strong> <strong><code>clone</code></strong> <strong>method</strong> because it would merely encourage wasteful copying.</p>
<h3 id="2-Class-with-no-references-to-mutable-state"><a href="#2-Class-with-no-references-to-mutable-state" class="headerlink" title="2. Class with no references to mutable state"></a>2. Class with no references to mutable state</h3><p>First impelement <code>Cloneable</code> interface.</p>
<p>The <code>clone</code> method would look like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Clone method for class with no references to mutable state</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> PhoneNumber <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">return</span> (PhoneNumber) <span class="hljs-built_in">super</span>.clone();<br>  &#125; <span class="hljs-keyword">catch</span> (CloneNotSupportedException e) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AssertionError</span>(); <span class="hljs-comment">// Can&#x27;t happen</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-Class-with-fields-that-refer-to-mutable-objects"><a href="#3-Class-with-fields-that-refer-to-mutable-objects" class="headerlink" title="3. Class with fields that refer to mutable objects"></a>3. Class with fields that refer to mutable objects</h3><p>Example: the <em>Stack</em> class in Item 7</p>
<p>If simply call <code>super.clone()</code>, its <em>elements</em> field will refer to the <strong>same array</strong> as the original <em>Stack</em> instance.</p>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><p>Call <code>clone</code> recursively on the <em>elements</em> array:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Clone method for class with no references to mutable state</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Stack <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">Stack</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (Stack) <span class="hljs-built_in">super</span>.clone();<br>    result.elements = elements.clone();<br>    <span class="hljs-keyword">return</span> result;<br>  &#125; <span class="hljs-keyword">catch</span> (CloneNotSupportedException e) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AssertionError</span>();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<ol>
<li>Note that we do not have to cast the result of elements.clone to Object[]. Calling clone on an array returns an array whose runtime and compile-time types are identical to those of the array being cloned. This is the preferred idiom to duplicate an array. In fact, <strong>arrays are the sole compelling use of the clone facility</strong>.</li>
<li>Note also that the earlier solution would not work if the elements field were <strong>final</strong> because clone would be prohibited from assigning a new value to the field. This is a fundamental problem: like serialization, <strong>the</strong> <strong><code>Cloneable</code></strong> <strong>architecture is incompatible with normal use of final fields referring to mutable objects</strong>. In order to make a class cloneable, it may be necessary to remove final modifiers from some fields.</li>
</ol>
</blockquote>
<h3 id="4-Class-with-inner-class"><a href="#4-Class-with-inner-class" class="headerlink" title="4. Class with inner class"></a>4. Class with inner class</h3><p>Example: HashTable implemented using its own linked list</p>
<h4 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution 1"></a>Solution 1</h4><p>Add a <code>deepCopy</code> method to the inner class.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Iteratively copy the linked list headed by this Entry</span><br>Entry <span class="hljs-title function_">deepCopy</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-type">Entry</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(key, value, next);<br>  <span class="hljs-keyword">for</span> (<span class="hljs-type">Entry</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> result; p.next != <span class="hljs-literal">null</span>; p = p.next)<br>    p.next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>(p.next.key, p.next.value, p.next.next);<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>clone</code> method of <em>HashTable</em> class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> HashTable <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">HashTable</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (HashTable) <span class="hljs-built_in">super</span>.clone();<br>    result.buckets = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Entry</span>[buckets.length];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; buckets.length; i ++)<br>      <span class="hljs-keyword">if</span> (buckets[i] != <span class="hljs-literal">null</span>)<br>        result.buckets[i] = buckets[i].deepCopy();<br>    <span class="hljs-keyword">return</span> result;<br>  &#125; <span class="hljs-keyword">catch</span> (CloneNotSupportedException e) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AssertionError</span>();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution 2"></a>Solution 2</h4><p>Call <code>super.clone</code>, set all of the fields in the resulting object to their <strong>initial state</strong>, and then call higher-level methods to regenerate the state of the original object.</p>
<p>In the case of our HashTable example, the buckets field would be initialized to a new bucket array, and the put(key, value) method would be invoked for each key-value mapping in the hash table being cloned.</p>
<blockquote>
<p>It is antithetical to the whole Cloneable architecture because it blindly overwrites the field-by-field object copy that forms the basis of the architecture.</p>
</blockquote>
<h2 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h2><ol>
<li><p>Like a constructor, a <code>clone</code> method must <strong>never invoke an overridable method on the clone</strong> under construction (Item 19). If clone invokes a method that is overridden in a subclass, this method will execute before the subclass has had a chance to fix its state in the clone, quite possibly leading to corruption in the clone and the original.</p>
<blockquote>
<p>Therefore, the put(key, value) method discussed in the previous paragraph should be either final or private. (If it is private, it is presumably the “helper method” for a nonfinal public method.)</p>
</blockquote>
</li>
<li><p><em>Object</em>’s <code>clone</code> method is declared to throw <code>CloneNotSupportedException</code>, but overriding methods need not. <strong>Public</strong> <strong><code>clone</code></strong> <strong>methods should omit the</strong> <strong>throws</strong> <strong>clause</strong>, as methods that don’t throw checked exceptions are easier to use (Item 71).</p>
</li>
<li><p>You have two choices when designing a <strong>class for inheritance</strong> (Item 19), but whichever one you choose, the class <strong>should <em>not</em> implement <code>Cloneable</code>.</strong></p>
<ul>
<li><p>You may choose to mimic the behavior of <em>Object</em> by <strong>implementing a properly functioning protected <code>clone</code> method that is declared to throw <code>CloneNotSupportedException</code>.</strong> This gives subclasses the freedom to implement Cloneable or not, just as if  dthey extended <em>Object</em> directly.</p>
</li>
<li><p>Alternatively, you may choose <strong><em>not</em> to implement a working <code>clone</code> method</strong>, and to <strong>prevent subclasses from implementing</strong> one, by providing the following <strong>degenerate <code>clone</code></strong> implementation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// clone method for extendable class not supporting Cloneable</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> Object <span class="hljs-title function_">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException &#123;<br>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CloneNotSupportedException</span>();<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>If you write a <strong>thread-safe class</strong> that implements Cloneable, remember that its <strong><code>clone</code> method must be properly synchronized</strong>, just like any other method (Item 78). <em>Object</em>’s clone method is not synchronized.</p>
</li>
</ol>
<h4 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h4><p>To recap, all classes that implement <code>Cloneable</code> should override <code>clone</code> with a public method whose <strong>return type is the class itself</strong>. This method should first <strong>call <code>super.clone</code></strong>, then <strong>fix any fields</strong> that need fixing.</p>
<p>Typically, this means copying any mutable objects that comprise the internal “deep structure” of the object and replacing the clone’s references to these objects with references to their copies.</p>
<p>If the class contains only primitive fields or references to immutable objects, then it is likely the case that no fields need to be fixed. There are exceptions to this rule. For example, a field representing a serial number or other unique ID will need to be fixed even if it is primitive or immutable.</p>
<h2 id="Better-approaches-to-object-copying"><a href="#Better-approaches-to-object-copying" class="headerlink" title="Better approaches to object copying"></a>Better approaches to object copying</h2><p><strong>A better approach to object copying is to provide a <em>copy constructor</em> or <em>copy factory</em>.</strong></p>
<p>A copy constructor is simply a constructor that takes a single argument whose type is the class containing the constructor, for example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Copy constructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Yum</span><span class="hljs-params">(Yum yum)</span> &#123; ... &#125;;<br></code></pre></td></tr></table></figure>

<p>A copy factory is the static factory (Item 1) analogue of a copy constructor:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Copy factory</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Yum <span class="hljs-title function_">newInstance</span><span class="hljs-params">(Yum yum)</span> &#123; ... &#125;;<br></code></pre></td></tr></table></figure>

<h3 id="Advantages"><a href="#Advantages" class="headerlink" title="Advantages"></a>Advantages</h3><ul>
<li><p>they don’t rely on a risk-prone extralinguistic object creation mechanism;</p>
</li>
<li><p>they don’t demand unenforceable adherence to thinly documented conventions;</p>
</li>
<li><p>they don’t conflict with the proper use of <strong>final fields</strong>;</p>
</li>
<li><p>they don’t throw unnecessary <strong>checked exceptions</strong>;</p>
</li>
<li><p>they don’t require <strong>type casts</strong>.</p>
</li>
<li><p>a copy constructor or factory can take <strong>an argument</strong> whose type is <strong>an interface implemented by the class</strong>.</p>
<blockquote>
<p>For example, suppose you have a HashSet, s, and you want to copy it as a TreeSet. The clone method can’t offer this functionality, but it’s easy with a conversion constructor: new TreeSet&lt;&gt;(s).</p>
</blockquote>
</li>
</ul>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>Given all the problems associated with <code>Cloneable</code>, new <strong>interfaces</strong> should not extend it, and new <strong>extendable classes</strong> should not implement it.</p>
<p>While it’s less harmful for <strong>final classes</strong> to implement <code>Cloneable</code>, this should be viewed as a performance optimization, reserved for the rare cases where it is justified (Item 67).</p>
<p>As a rule, <em>copy</em> functionality is best provided by <strong>constructors or factories</strong>.</p>
<blockquote>
<p>A notable exception to this rule is <strong>arrays</strong>, which are best copied with the <code>clone</code> method.</p>
</blockquote>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Java/" class="category-chain-item">Java</a>
  
  
    <span>></span>
    
  <a href="/categories/Java/Effective-Java/" class="category-chain-item">Effective Java</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Effective Java-13. Override clone judiciously</div>
      <div>https://peixuanhu.github.io/2023/11/16/Java/effective-java/Item13-Override-clone-judiciously/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Peixuan Hu</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>November 16, 2023</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Updated on</div>
          <div>November 22, 2023</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/11/16/book-notes/%E6%B5%AA%E6%BD%AE%E4%B9%8B%E5%B7%85/Apple-and-Microsoft/" title="浪潮之巅读书笔记3-苹果与微软">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">浪潮之巅读书笔记3-苹果与微软</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/11/15/book-notes/%E6%B5%AA%E6%BD%AE%E4%B9%8B%E5%B7%85/silicon-valley/" title="浪潮之巅读书笔记2-硅谷">
                        <span class="hidden-mobile">浪潮之巅读书笔记2-硅谷</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'peixuanhu/peixuanhu.github.io');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        Views: 
        <span id="busuanzi_value_site_pv"></span>
        
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        Visitors: 
        <span id="busuanzi_value_site_uv"></span>
        
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
